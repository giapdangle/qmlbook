<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7. Canvas Element &mdash; Qt5 Cadaques Book v2014-12</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.2.0/sandstone/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2014-12',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Qt5 Cadaques Book v2014-12" href="../index.html" />
    <link rel="next" title="8. Particle Simulations" href="../ch08/index.html" />
    <link rel="prev" title="6. Model-View-Delegate" href="../ch06/index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          QmlBook</a>
        <span class="navbar-text navbar-version pull-left"><b>2014-12</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ch01/index.html">1. Meet Qt 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch02/index.html">2. Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch03/index.html">3. Qt Creator IDE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch04/index.html">4. Quick Starter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch05/index.html">5. Fluid Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch06/index.html">6. Model-View-Delegate</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">7. Canvas Element</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch08/index.html">8. Particle Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch09/index.html">9. Shader Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch10/index.html">10. Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch11/index.html">11. Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch12/index.html">12. Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch13/index.html">13. Dynamic QML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch14/index.html">14. JavaScript</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">7. Canvas Element</a><ul>
<li><a class="reference internal" href="#convenient-api">7.1. Convenient API</a></li>
<li><a class="reference internal" href="#gradients">7.2. Gradients</a></li>
<li><a class="reference internal" href="#shadows">7.3. Shadows</a></li>
<li><a class="reference internal" href="#images">7.4. Images</a></li>
<li><a class="reference internal" href="#transformation">7.5. Transformation</a></li>
<li><a class="reference internal" href="#composition-modes">7.6. Composition Modes</a></li>
<li><a class="reference internal" href="#pixel-buffers">7.7. Pixel Buffers</a></li>
<li><a class="reference internal" href="#canvas-paint">7.8. Canvas Paint</a></li>
<li><a class="reference internal" href="#porting-from-html5-canvas">7.9. Porting from HTML5 Canvas</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../ch06/index.html" title="Previous Chapter: 6. Model-View-Delegate"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 6. Model-View-De...</span>
    </a>
  </li>
  <li>
    <a href="../ch08/index.html" title="Next Chapter: 8. Particle Simulations"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">8. Particle Simu... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">7. Canvas Element</a><ul>
<li><a class="reference internal" href="#convenient-api">7.1. Convenient API</a></li>
<li><a class="reference internal" href="#gradients">7.2. Gradients</a></li>
<li><a class="reference internal" href="#shadows">7.3. Shadows</a></li>
<li><a class="reference internal" href="#images">7.4. Images</a></li>
<li><a class="reference internal" href="#transformation">7.5. Transformation</a></li>
<li><a class="reference internal" href="#composition-modes">7.6. Composition Modes</a></li>
<li><a class="reference internal" href="#pixel-buffers">7.7. Pixel Buffers</a></li>
<li><a class="reference internal" href="#canvas-paint">7.8. Canvas Paint</a></li>
<li><a class="reference internal" href="#porting-from-html5-canvas">7.9. Porting from HTML5 Canvas</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="canvas-element">
<h1>7. Canvas Element<a class="headerlink" href="#canvas-element" title="Permalink to this headline">Â¶</a></h1>
<p><em>Section author: <a class="reference external" href="https://github.com/jryannel">jryannel</a></em></p>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23canvas-element&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Last Build: December 22, 2014 at 17:41 CET</p>
<p class="last">The source code for this chapter can be found in the <a class="reference external" href="../assets">assets folder</a>.</p>
</div>
<img alt="../_images/glowlines.png" src="../_images/glowlines.png" />
<p>Early on when QML was introduced in Qt4 there where some discussions about if QtQuick needs an ellipse. The problem with the ellipse is that others can argue other shapes need also be supported. So there is no ellipse in Qt Quick only rectangular shapes. If you needed one in Qt4 you would need to use an image or write your own C++ ellipse element.</p>
<p>To allow scripted drawings Qt5 introduces the canvas element. The canvas elements provides a resolution-dependent bitmap canvas, which can be used for graphics, games or to paint other visual images on the fly using JavaScript. The canvas element is based on the HTML5 canvas element.</p>
<p>The fundamental idea of the canvas element is to render paths using a context 2D object. The context 2D object, contains the necessary graphics functions, whereas the canvas acts as the drawing canvas. The 2D context supports strokes, fills, gradients, text and a different sets of path creation commands.</p>
<p>Let&#8217;s see an example of a simple path drawing:</p>
<div class="highlight-qml"><div class="highlight"><pre><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.0</span>

<span class="nx">Canvas</span> <span class="p">{</span>
    <span class="kd">id: root</span>
    <span class="c1">// canvas size</span>
    <span class="k">width:</span> <span class="mi">200</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">200</span>
    <span class="c1">// handler to override for drawing</span>
    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="c1">// get context to draw with</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
        <span class="c1">// setup the stroke</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
        <span class="c1">// setup the fill</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;steelblue&quot;</span>
        <span class="c1">// begin a new path to draw</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="c1">// top-left start point</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="c1">// upper line</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="c1">// right line</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
        <span class="c1">// bottom line</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
        <span class="c1">// left line through path closing</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="c1">// fill using fill style</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
        <span class="c1">// stroke using line width and stroke style</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This produces a filled rectangle with a starring point at 50,50 and a size of 100 and a stroke used as a border decoration.</p>
<img alt="../_images/rectangle.png" src="../_images/rectangle.png" />
<p>The stroke width is set to 4 and uses a blue color define by <tt class="docutils literal"><span class="pre">strokeStyle</span></tt>. The final shape is setup to be filled through the <tt class="docutils literal"><span class="pre">fillStyle</span></tt> to a &#8220;steelblue&#8221; color. Only by calling <tt class="docutils literal"><span class="pre">stroke</span></tt> or <tt class="docutils literal"><span class="pre">fill</span></tt> the actual path will be drawn and they can be used independently from each other. A call to <tt class="docutils literal"><span class="pre">stroke</span></tt> or <tt class="docutils literal"><span class="pre">fill</span></tt> will draw the current path. It&#8217;s not possible to store a path for later reuse only a drawing state can be stored and restored.</p>
<p>In QML the <tt class="docutils literal"><span class="pre">Canvas</span></tt> element acts as a container for the drawing. The 2D context object provides the actual drawing operation. The actual drawing needs to be done inside the <tt class="docutils literal"><span class="pre">onPaint</span></tt> event handler.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">Canvas</span> <span class="p">{</span>
    <span class="nx">width</span><span class="o">:</span> <span class="mi">200</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">200</span>
    <span class="nx">onPaint</span><span class="o">:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
        <span class="c1">// setup your path</span>
        <span class="c1">// fill or/and stroke</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The canvas itself provides a typical two dimensional Cartesian coordinate system, where the top-left is the (0,0) point. A higher y-value goes down and a hight x-value goes to the right.</p>
<p>A typical order of commands for this path based API is the following:</p>
<ol class="arabic simple">
<li>Setup stroke and/or fill</li>
<li>Create path</li>
<li>Stroke and/or fill</li>
</ol>
<div class="highlight-qml"><div class="highlight"><pre>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>

        <span class="c1">// setup the stroke</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>

        <span class="c1">// create a path</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>

        <span class="c1">// stroke path</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>This produces a horizontal stroked line from point <tt class="docutils literal"><span class="pre">P1(50,50)</span></tt> to point <tt class="docutils literal"><span class="pre">P2(150,50)</span></tt>.</p>
<img alt="../_images/line.png" src="../_images/line.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Typically you always want to set a start point when you reset your path, so the first operation after <tt class="docutils literal"><span class="pre">beginPath</span></tt> is often <tt class="docutils literal"><span class="pre">moveTo</span></tt>.</p>
</div>
<div class="section" id="convenient-api">
<h2>7.1. Convenient API<a class="headerlink" href="#convenient-api" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23convenient-api&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><p>For operations on rectangles a convenience API is provided which draws directly and does need a stroke or fill call.</p>
<div class="highlight-qml"><div class="highlight"><pre><span class="c1">// convenient.qml</span>

<span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.0</span>

<span class="nx">Canvas</span> <span class="p">{</span>
    <span class="kd">id: root</span>
    <span class="k">width:</span> <span class="mi">120</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">120</span>
    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="c1">// draw a filles rectangle</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
        <span class="c1">// cut our an inner rectangle</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="c1">// stroke a border from top-left to</span>
        <span class="c1">// inner center of the larger rectangle</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeRect</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<img alt="../_images/convenient.png" src="../_images/convenient.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The stroke area extends half of the line width on both sides of the path. A 4 px lineWidth will draw 2 px outside the path and 2 px inside.</p>
</div>
</div>
<div class="section" id="gradients">
<h2>7.2. Gradients<a class="headerlink" href="#gradients" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23gradients&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><p>Canvas can fill shapes with color but also with gradients or images.</p>
<div class="highlight-qml"><div class="highlight"><pre>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>

        <span class="kd">var</span> <span class="nx">gradient</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;lightsteelblue&quot;</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">gradient</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The gradient in this example is defined along the starting point (100,0) to the end point (100,200), which gives a vertical line in the middle of our canvas. The gradient stops can be define as a color from 0.0 (gradient start point) to 1.0 (gradient end point). Here we use a &#8220;blue&#8221; color at 0.0 (100,0) and a &#8220;lightsteelblue&#8221; color at the 0.5 (100,200) position. The gradient is defined much larger then the rectangle we want to draw, so the rectangle clips gradient to it&#8217;s defined geometry.</p>
<img alt="../_images/gradient.png" src="../_images/gradient.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The gradient is defined in canvas coordinates not in coordinates relative to the path to be painted. A canvas does not have the concept of relative coordinates, as we are used to by now from QML.</p>
</div>
</div>
<div class="section" id="shadows">
<h2>7.3. Shadows<a class="headerlink" href="#shadows" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23shadows&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We had difficulties with shadows in the Qt5 alpha release.</p>
</div>
<p>A path can be visually enhanced using shadows with the 2D context object. A shadow is an area around the path with an offset, color and specified blurring. For this you need can specify a <tt class="docutils literal"><span class="pre">shadowColor</span></tt>, <tt class="docutils literal"><span class="pre">shadowOffsetX</span></tt>, <tt class="docutils literal"><span class="pre">shadowOffsetY</span></tt> and a <tt class="docutils literal"><span class="pre">shadowBlur</span></tt>. All of this needs to be defined using the 2D context. The 2D context is your only API to the drawing operations.</p>
<p>A shadow can also be used to create a glow effect around a path. In the next example we create a text &#8220;Earth&#8221; with a white glow around. All this on a dark background for better visibility.</p>
<p>First we draw the dark background:</p>
<div class="highlight-qml"><div class="highlight"><pre>        <span class="c1">// setup a dark background</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;#333&quot;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
</pre></div>
</div>
<p>then we define our shadow configuration, which will be used for the next path:</p>
<div class="highlight-qml"><div class="highlight"><pre>        <span class="nx">ctx</span><span class="p">.</span><span class="nx">shadowColor</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">shadowOffsetX</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">shadowOffsetY</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="c1">// next line crashes</span>
        <span class="c1">// ctx.shadowBlur = 10;</span>
</pre></div>
</div>
<p>Finally we draw our &#8220;Earth&#8221; text using a large bold 80px font from the <em>Ubuntu</em> font family.</p>
<div class="highlight-qml"><div class="highlight"><pre>        <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s1">&#39;Bold 80px Ubuntu&#39;</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;#33a9ff&quot;</span><span class="p">;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&quot;Earth&quot;</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">180</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">show screen-shot from example, when shadows will work on Qt5</p>
</div>
</div>
<div class="section" id="images">
<h2>7.4. Images<a class="headerlink" href="#images" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23images&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><p>The QML canvas supports image drawing from several sources. To use an image inside the canvas the image needs to be loaded first. We will use the <tt class="docutils literal"><span class="pre">Component.onCompleted</span></tt> handler to load the image in our example.</p>
<div class="highlight-qml"><div class="highlight"><pre>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>


        <span class="c1">// draw an image</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="s1">&#39;assets/ball.png&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c1">// store current context setup</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
        <span class="c1">// create a triangle as clip region</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span><span class="mi">55</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="c1">// translate coordinate system</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>        
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">clip</span><span class="p">()</span>  <span class="c1">// create clip from triangle path</span>
        <span class="c1">// draw image with clip applied</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="s1">&#39;assets/ball.png&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="c1">// draw stroke around path</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
        <span class="c1">// restore previous setup</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

    <span class="p">}</span>

    <span class="k">Component.onCompleted:</span> <span class="p">{</span>
        <span class="nx">loadImage</span><span class="p">(</span><span class="s2">&quot;assets/ball.png&quot;</span><span class="p">)</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The left shows our ball image painted at the top-left position of 10x10. The right image shows the ball with a clip path applied. Images and any other path can be clipped using another path. The clipping is applied by defining a path and calling the <tt class="docutils literal"><span class="pre">clip()</span></tt> function. All following drawing operations will now be clipped by this path. The clipping is disabled again by restoring the previous state or by setting the clip region to the whole canvas.</p>
<img alt="../_images/canvas_image.png" src="../_images/canvas_image.png" />
</div>
<div class="section" id="transformation">
<h2>7.5. Transformation<a class="headerlink" href="#transformation" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23transformation&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><p>The canvas allows you to transform the coordinate system in several ways. This is very similar to the transformation offered by QML items. You have the possibility to <tt class="docutils literal"><span class="pre">scale</span></tt>, <tt class="docutils literal"><span class="pre">rotate</span></tt>, <tt class="docutils literal"><span class="pre">translate</span></tt> the coordinate system. In difference to QML the transform origin is always the canvas origin. For example to scale a path around it&#8217;s center you would need to translate the canvas origin to the center of the path. It is also possible to apply a more complex transformation using the transform method.</p>
<div class="highlight-qml"><div class="highlight"><pre><span class="c1">// transform.qml</span>

<span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.0</span>

<span class="nx">Canvas</span> <span class="p">{</span>
    <span class="kd">id: root</span>
    <span class="k">width:</span> <span class="mi">240</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">120</span>
    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

        <span class="c1">// draw path now rotated</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<img alt="../_images/transform.png" src="../_images/transform.png" />
<p>Besides translate the canvas allows also to scale using <tt class="docutils literal"><span class="pre">scale(x,y)</span></tt> around x and y axis, to rotate using <tt class="docutils literal"><span class="pre">rotate(angle)</span></tt>, where the angle is given in radius (<em>360 degree = 2*Math.PI</em>) and to use a matrix transformation using the <tt class="docutils literal"><span class="pre">setTransform(m11,</span> <span class="pre">m12,</span> <span class="pre">m21,</span> <span class="pre">m22,</span> <span class="pre">dx,</span> <span class="pre">dy)</span></tt>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The transformation seems to behave different then the the HTML5 canvas. Not sure if this is a bug.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To reset any transformation you can call the <tt class="docutils literal"><span class="pre">resetTransform()</span></tt> function to set the transformation matrix back to the identity matrix:</p>
<div class="last highlight-qml"><div class="highlight"><pre><span class="nx">ctx</span><span class="p">.</span><span class="nx">resetTransform</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="composition-modes">
<h2>7.6. Composition Modes<a class="headerlink" href="#composition-modes" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23composition-modes&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><p>Composition allows you to draw a shape and blend it with the existing pixels. The canvas supports several composition modes using the <tt class="docutils literal"><span class="pre">globalCompositeOperation(mode)</span></tt> operation.</p>
<ul class="simple">
<li>&#8220;source-over&#8221;</li>
<li>&#8220;source-in&#8221;</li>
<li>&#8220;source-out&#8221;</li>
<li>&#8220;source-atop&#8221;</li>
</ul>
<div class="highlight-qml"><div class="highlight"><pre>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalCompositeOperation</span> <span class="o">=</span> <span class="s2">&quot;xor&quot;</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;#33a9ff&quot;</span>

        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">40</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">400</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>This little examples iterates over a list of composite modes and generates a rectangle with a circle.</p>
<div class="highlight-qml"><div class="highlight"><pre>    <span class="nx">property</span> <span class="kd">var</span> <span class="k">operation :</span> <span class="p">[</span>
        <span class="s1">&#39;source-over&#39;</span><span class="p">,</span> <span class="s1">&#39;source-in&#39;</span><span class="p">,</span> <span class="s1">&#39;source-over&#39;</span><span class="p">,</span>
        <span class="s1">&#39;source-atop&#39;</span><span class="p">,</span> <span class="s1">&#39;destination-over&#39;</span><span class="p">,</span> <span class="s1">&#39;destination-in&#39;</span><span class="p">,</span>
        <span class="s1">&#39;destination-out&#39;</span><span class="p">,</span> <span class="s1">&#39;destination-atop&#39;</span><span class="p">,</span> <span class="s1">&#39;lighter&#39;</span><span class="p">,</span>
        <span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="s1">&#39;xor&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-clear&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-destination&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qt-multiply&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-screen&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-overlay&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-darken&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qt-lighten&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-color-dodge&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-color-burn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qt-hard-light&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-soft-light&#39;</span><span class="p">,</span> <span class="s1">&#39;qt-difference&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qt-exclusion&#39;</span>
        <span class="p">]</span>

    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">)</span>
        
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">operation</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>            
            <span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="kd">var</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;#33a9ff&#39;</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">10</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span><span class="mi">10</span><span class="o">+</span><span class="nx">dy</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
            <span class="c1">// TODO: does not work yet</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalCompositeOperation</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">operation</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;#ff33a9&#39;</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mf">0.75</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mi">60</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="mi">60</span><span class="o">+</span><span class="nx">dy</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span>            
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>            
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="pixel-buffers">
<h2>7.7. Pixel Buffers<a class="headerlink" href="#pixel-buffers" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23pixel-buffers&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><p>When working with the canvas you are able to retrieve pixel data from the canvas to read or manipulate the pixels of your canvas. To read the image data use <tt class="docutils literal"><span class="pre">createImageData(sw,sh)</span></tt> or <tt class="docutils literal"><span class="pre">getImageData(sx,sy,sw,sh)</span></tt>. Both functions return an <tt class="docutils literal"><span class="pre">ImageData</span></tt> object with a <tt class="docutils literal"><span class="pre">width</span></tt>, <tt class="docutils literal"><span class="pre">height</span></tt> and a <tt class="docutils literal"><span class="pre">data</span></tt> variable. The data variable contains a one-dimensional array of the pixel data retrieved in the <em>RGBA</em> format, where each value varies in the range of 0 to 255. To set pixels on the canvas you can use the <tt class="docutils literal"><span class="pre">putImageData(imagedata,,</span> <span class="pre">dx,</span> <span class="pre">dy)</span></tt> function.</p>
<p>Another way to retrieve the content of the canvas is to store the data into an image. This can be achieved with the <tt class="docutils literal"><span class="pre">Canvas</span></tt> functions <tt class="docutils literal"><span class="pre">save(path)</span></tt> or <tt class="docutils literal"><span class="pre">toDataURL(mimeType)</span></tt>, where the later function returns an image url, which can be used to be loaded by an <tt class="docutils literal"><span class="pre">Image</span></tt> element.</p>
<div class="highlight-qml"><div class="highlight"><pre><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.0</span>

<span class="nx">Rectangle</span> <span class="p">{</span>
    <span class="k">width:</span> <span class="mi">240</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">120</span>
    <span class="nx">Canvas</span> <span class="p">{</span>
        <span class="kd">id: canvas</span>
        <span class="k">x:</span> <span class="mi">10</span><span class="p">;</span> <span class="k">y:</span> <span class="mi">10</span>
        <span class="k">width:</span> <span class="mi">100</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">100</span>
        <span class="nx">property</span> <span class="nx">real</span> <span class="k">hue:</span> <span class="mf">0.0</span>
        <span class="k">onPaint:</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
            <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span>
            <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span>
            <span class="nx">hue</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.1</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">hue</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">hue</span> <span class="o">-=</span> <span class="mi">1</span> <span class="p">}</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mf">0.7</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">hsla</span><span class="p">(</span><span class="nx">hue</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span> <span class="nx">x</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nx">MouseArea</span> <span class="p">{</span>
            <span class="k">anchors.fill:</span> <span class="nx">parent</span>
            <span class="k">onClicked:</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s1">&#39;image/png&#39;</span><span class="p">)</span>
                <span class="nx">print</span><span class="p">(</span><span class="s1">&#39;image url=&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
                <span class="nx">image</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">url</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">Image</span> <span class="p">{</span>
        <span class="kd">id: image</span>
        <span class="k">x:</span> <span class="mi">130</span><span class="p">;</span> <span class="k">y:</span> <span class="mi">10</span>
        <span class="k">width:</span> <span class="mi">100</span><span class="p">;</span> <span class="k">height:</span> <span class="mi">100</span>
    <span class="p">}</span>

    <span class="nx">Timer</span> <span class="p">{</span>
        <span class="k">interval:</span> <span class="mi">1000</span>
        <span class="k">running:</span> <span class="kc">true</span>
        <span class="k">triggeredOnStart:</span> <span class="kc">true</span>
        <span class="k">repeat:</span> <span class="kc">true</span>
        <span class="k">onTriggered:</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">requestPaint</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In our little example we paint every second a small circle in the left canvas. When the use clicks on the mouse area the canvas content is stored and a image url is retrieved. On the right side of our example the image is then displayed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Retrieving image data seems not to work currently in the Qt5 Alpha SDK.</p>
</div>
</div>
<div class="section" id="canvas-paint">
<h2>7.8. Canvas Paint<a class="headerlink" href="#canvas-paint" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23canvas-paint&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><p>In this example we would like to create a small paint application using the <tt class="docutils literal"><span class="pre">Canvas</span></tt> element.</p>
<img alt="../_images/canvaspaint.png" src="../_images/canvaspaint.png" />
<p>For this we arrange four color squares on the top of our scene using a row positioner. A color square is a simple rectangle filled with a mouse area to detect clicks.</p>
<div class="highlight-qml"><div class="highlight"><pre>    <span class="nx">Row</span> <span class="p">{</span>
        <span class="kd">id: colorTools</span>
        <span class="nx">anchors</span> <span class="p">{</span>
            <span class="k">horizontalCenter:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">horizontalCenter</span>
            <span class="k">top:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">top</span>
            <span class="k">topMargin:</span> <span class="mi">8</span>
        <span class="p">}</span>
        <span class="nx">property</span> <span class="nx">variant</span> <span class="k">activeSquare:</span> <span class="nx">red</span>
        <span class="nx">property</span> <span class="nx">color</span> <span class="k">paintColor:</span> <span class="s2">&quot;#33B5E5&quot;</span>
        <span class="k">spacing:</span> <span class="mi">4</span>
        <span class="nx">Repeater</span> <span class="p">{</span>
            <span class="k">model:</span> <span class="p">[</span><span class="s2">&quot;#33B5E5&quot;</span><span class="p">,</span> <span class="s2">&quot;#99CC00&quot;</span><span class="p">,</span> <span class="s2">&quot;#FFBB33&quot;</span><span class="p">,</span> <span class="s2">&quot;#FF4444&quot;</span><span class="p">]</span>
            <span class="nx">ColorSquare</span> <span class="p">{</span>
                <span class="kd">id: red</span>
                <span class="k">color:</span> <span class="nx">modelData</span>
                <span class="k">active:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">paintColor</span> <span class="o">==</span> <span class="nx">color</span>
                <span class="k">onClicked:</span> <span class="p">{</span>
                    <span class="nx">parent</span><span class="p">.</span><span class="nx">paintColor</span> <span class="o">=</span> <span class="nx">color</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The colors are stored in an array and the paint color. When one the user clicks in one of the squares the color of the square is assigned to the <tt class="docutils literal"><span class="pre">paintColor</span></tt> property of the the row named <em>colorTools</em>.</p>
<p>To enable tracking of the mouse events on the canvas we have a <tt class="docutils literal"><span class="pre">MouseArea</span></tt> covering the canvas element and hooked up the pressed and position changed handlers.</p>
<div class="highlight-qml"><div class="highlight"><pre>    <span class="nx">Canvas</span> <span class="p">{</span>
        <span class="kd">id: canvas</span>
        <span class="nx">anchors</span> <span class="p">{</span>
            <span class="k">left:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">left</span>
            <span class="k">right:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">right</span>
            <span class="k">top:</span> <span class="nx">colorTools</span><span class="p">.</span><span class="nx">bottom</span>
            <span class="k">bottom:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">bottom</span>
            <span class="k">margins:</span> <span class="mi">8</span>
        <span class="p">}</span>
        <span class="nx">property</span> <span class="nx">real</span> <span class="nx">lastX</span>
        <span class="nx">property</span> <span class="nx">real</span> <span class="nx">lastY</span>
        <span class="nx">property</span> <span class="nx">color</span> <span class="k">color:</span> <span class="nx">colorTools</span><span class="p">.</span><span class="nx">paintColor</span>

        <span class="k">onPaint:</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">color</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">)</span>
            <span class="nx">lastX</span> <span class="o">=</span> <span class="nx">area</span><span class="p">.</span><span class="nx">mouseX</span>
            <span class="nx">lastY</span> <span class="o">=</span> <span class="nx">area</span><span class="p">.</span><span class="nx">mouseY</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">)</span>
            <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nx">MouseArea</span> <span class="p">{</span>
            <span class="kd">id: area</span>
            <span class="k">anchors.fill:</span> <span class="nx">parent</span>
            <span class="k">onPressed:</span> <span class="p">{</span>
                <span class="nx">canvas</span><span class="p">.</span><span class="nx">lastX</span> <span class="o">=</span> <span class="nx">mouseX</span>
                <span class="nx">canvas</span><span class="p">.</span><span class="nx">lastY</span> <span class="o">=</span> <span class="nx">mouseY</span>
            <span class="p">}</span>
            <span class="k">onPositionChanged:</span> <span class="p">{</span>
                <span class="nx">canvas</span><span class="p">.</span><span class="nx">requestPaint</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>A mouse press stores the initial mouse position into the <em>lastX</em> and <em>lastY</em> properties. Every change on the mouse position triggers a paint request on the canvas, which will result into calling the <em>onPaint</em> handler.</p>
<p>To finally draw the users stroke, in the <em>onPaint</em> handler we begin a new path and move to the last position. Then we gather the new position from the mouse area and draw a line with the selected color to the new position. The mouse position is stored as the new <em>last</em> position.</p>
</div>
<div class="section" id="porting-from-html5-canvas">
<h2>7.9. Porting from HTML5 Canvas<a class="headerlink" href="#porting-from-html5-canvas" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition issues">Issues: <a href="https://github.com/qmlbook/qmlbook/issues/new?body=back-link%3A+ch07%2Findex.html%23porting-from-html5-canvas&labels=ch07">Create</a> | <a href="https://github.com/qmlbook/qmlbook/issues?labels=ch07&page=1&state=open">View</a></div><ul class="simple">
<li><a class="reference external" href="https://developer.mozilla.org/en/Canvas_tutorial/Transformations">https://developer.mozilla.org/en/Canvas_tutorial/Transformations</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Spirograph">http://en.wikipedia.org/wiki/Spirograph</a></li>
</ul>
<p>It is fairly easy to port a HTML5 canvas graphics over to use the QML canvas. From the thousands of examples, we picked one and tried it ourself.</p>
<p><strong>Spiro Graph</strong></p>
<p>We use a <a class="reference external" href="http://en.wikipedia.org/wiki/Spirograph">spiro graph</a> example from the Mozilla project as our foundation. The original HTML5 was posted as part of the <a class="reference external" href="https://developer.mozilla.org/en/Canvas_tutorial/Transformations">canvas tutorial</a>.</p>
<p>There where a few lines we needed to change:</p>
<ul>
<li><p class="first">Qt Quick requires you to declare variable, so we needed to add some <em>var</em> declarations</p>
<blockquote>
<div><div class="highlight-js"><div class="highlight"><pre><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Adapted the draw method to receive the Context2D object</p>
<blockquote>
<div><div class="highlight-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">draw</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">we needed to adapt the translation for each spiro due to different sizes</p>
<blockquote>
<div><div class="highlight-js"><div class="highlight"><pre><span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="mi">20</span><span class="o">+</span><span class="nx">j</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span><span class="mi">20</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>Finally we inmpleted our <tt class="docutils literal"><span class="pre">onPaint</span></tt> handler. Inside we acquire a context and call our draw function.</p>
<div class="highlight-qml"><div class="highlight"><pre>    <span class="k">onPaint:</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
        <span class="nx">draw</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The result is a ported spiro graph graphics running using the QML canvas</p>
<img alt="../_images/spirograph.png" src="../_images/spirograph.png" />
<p>That&#8217;s all.</p>
<p><strong>Glowing Lines</strong></p>
<p>Here is another more complicated port from the W3C organization. The original <a class="reference external" href="http://www.w3.org/TR/2dcontext/#examples">pretty glowing lines</a> has some pretty nice aspects, which makes the porting more challenging.</p>
<img alt="../_images/html_glowlines.png" src="../_images/html_glowlines.png" />
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Pretty Glowing Lines<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;canvas</span> <span class="na">width=</span><span class="s">&quot;800&quot;</span> <span class="na">height=</span><span class="s">&quot;450&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
<span class="nt">&lt;script&gt;</span>
var context = document.getElementsByTagName(&#39;canvas&#39;)[0].getContext(&#39;2d&#39;);

// initial start position
var lastX = context.canvas.width * Math.random();
var lastY = context.canvas.height * Math.random();
var hue = 0;

// closure function to draw
// a random bezier curve with random color with a glow effect
function line() {

    context.save();

    // scale with factor 0.9 around the center of canvas
    context.translate(context.canvas.width/2, context.canvas.height/2);
    context.scale(0.9, 0.9);
    context.translate(-context.canvas.width/2, -context.canvas.height/2);

    context.beginPath();
    context.lineWidth = 5 + Math.random() * 10;

    // our start position
    context.moveTo(lastX, lastY);

    // our new end position
    lastX = context.canvas.width * Math.random();
    lastY = context.canvas.height * Math.random();

    // random bezier curve, which ends on lastX, lastY
    context.bezierCurveTo(context.canvas.width * Math.random(),
    context.canvas.height * Math.random(),
    context.canvas.width * Math.random(),
    context.canvas.height * Math.random(),
    lastX, lastY);

    // glow effect
    hue = hue + 10 * Math.random();
    context.strokeStyle = &#39;hsl(&#39; + hue + &#39;, 50%, 50%)&#39;;
    context.shadowColor = &#39;white&#39;;
    context.shadowBlur = 10;
    // stroke the curve
    context.stroke();
    context.restore();
}

// call line function every 50msecs
setInterval(line, 50);

function blank() {
    // makes the background 10% darker on each call
    context.fillStyle = &#39;rgba(0,0,0,0.1)&#39;;
    context.fillRect(0, 0, context.canvas.width, context.canvas.height);
}

// call blank function every 50msecs
setInterval(blank, 40);

<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>In HTML5 the Context2D object can paint at any time on the canvas. In QML it can only point inside the <tt class="docutils literal"><span class="pre">onPaint</span></tt> handler. The timer in usage with <tt class="docutils literal"><span class="pre">setInterval</span></tt> triggers in HTML5 the stroke of the line or to blank the screen. Due to the different handling in QML it&#8217;s not possible to just call these functions, because we need to go through the <tt class="docutils literal"><span class="pre">onPaint</span></tt> handler. Also the color presentations needs to be adapted. Let&#8217;s go through the changes on by one.</p>
<p>Everything starts with the canvas element. For simplicity we just use the <tt class="docutils literal"><span class="pre">Canvas</span></tt> element as the root element of our QML file.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.0</span>

<span class="nx">Canvas</span> <span class="p">{</span>
   <span class="nx">id</span><span class="o">:</span> <span class="nx">canvas</span>
   <span class="nx">width</span><span class="o">:</span> <span class="mi">800</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">450</span>

   <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To untangle the direct call of the functions through the <tt class="docutils literal"><span class="pre">setInterval</span></tt>, we replace the <tt class="docutils literal"><span class="pre">setInterval</span></tt> calls with two timers which will request a repaint. A <tt class="docutils literal"><span class="pre">Timer</span></tt> is triggered after a short interval and allows us to execute some code. As we can&#8217;t tell the paint function which operation we would like trigger we define for each operation a bool flag request an operation and trigger then a repaint request.</p>
<p>Here is the code for the line operation. The blank operation is similar.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="p">...</span>
<span class="nx">property</span> <span class="nx">bool</span> <span class="nx">requestLine</span><span class="o">:</span> <span class="kc">false</span>

<span class="nx">Timer</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">lineTimer</span>
    <span class="nx">interval</span><span class="o">:</span> <span class="mi">40</span>
    <span class="nx">repeat</span><span class="o">:</span> <span class="kc">true</span>
    <span class="nx">triggeredOnStart</span><span class="o">:</span> <span class="kc">true</span>
    <span class="nx">onTriggered</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">requestLine</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">requestPaint</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Component</span><span class="p">.</span><span class="nx">onCompleted</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">lineTimer</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
<span class="p">}</span>
<span class="p">...</span>
</pre></div>
</div>
<p>Now we have a an indication which (line or blank or even both) operation we need to perform during the <tt class="docutils literal"><span class="pre">onPaint</span></tt> operation. As we enter the <tt class="docutils literal"><span class="pre">onPaint</span></tt> handler for each paint request we need to extract the initialization of the variable into the canvas element.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">Canvas</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="nx">property</span> <span class="nx">real</span> <span class="nx">hue</span><span class="o">:</span> <span class="mi">0</span>
    <span class="nx">property</span> <span class="nx">real</span> <span class="nx">lastX</span><span class="o">:</span> <span class="nx">width</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="nx">property</span> <span class="nx">real</span> <span class="nx">lastY</span><span class="o">:</span> <span class="nx">height</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now our paint function should look like this:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">onPaint</span><span class="o">:</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">requestLine</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">line</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>
        <span class="nx">requestLine</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">requestBlank</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">blank</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>
        <span class="nx">requestBlank</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <em>line</em> function was extracted gor a canvas as argument.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">line</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">);</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="o">-</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">;</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">);</span>
    <span class="nx">lastX</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="nx">lastY</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">bezierCurveTo</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span>
        <span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">);</span>

    <span class="nx">hue</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.1</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">hue</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">hue</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="p">}</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">hsla</span><span class="p">(</span><span class="nx">hue</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
    <span class="c1">// context.shadowColor = &#39;white&#39;;</span>
    <span class="c1">// context.shadowBlur = 10;</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The biggest change was the use of the QML <tt class="docutils literal"><span class="pre">Qt.rgba()</span></tt> and <tt class="docutils literal"><span class="pre">Qt.hsla()</span></tt> functions, which required to adapt the values to the used 0.0 ... 1.0 range in QML.</p>
<p>Same applies to the <em>blank</em> function.</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">blank</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The final result (without the shadows currently) will look similar to this.</p>
<img alt="../_images/glowlines.png" src="../_images/glowlines.png" />
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">There are currently heavy issues with the shadow implementation. This currently does not work</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Adobe Illustrator</p>
<p>Adobe Illustrator has a plug-in to export the artwork as HTML5 canvas code.</p>
<ul class="last simple">
<li><a class="reference external" href="http://visitmix.com/labs/ai2canvas/documentation.html">Adobe Illustrator Plug-in to HTML5 Canvas</a></li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="http://www.w3.org/TR/2dcontext/">W3C HTML Canvas 2D Context Specification</a></li>
<li><a class="reference external" href="https://developer.mozilla.org/en/HTML/Canvas">Mozilla Canvas Documentation</a></li>
<li><a class="reference external" href="http://www.html5canvastutorials.com/">HTML5 Canvas Tutorial</a></li>
</ul>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012-2014 JÃ¼rgen Bocklage-Ryannel and Johan Thelin. This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.<br/>
      Last updated on Dec 22, 2014.<br/>
    </p>
  </div>
</footer>
  </body>
</html>